To Verify Golang internal function, we cannot import it directly, since it's prohibited in Golang. And also, those function which name start with lowercase will not be imported. Thus, We have to create a new environment.

```sh
$ tree go_testing_env 
go_testing_env
├── go.mod
├── main
├── main.go
└── nistec
    ├── fiat
    │   ├── Dockerfile
    │   ├── fiat_test.go
    │   ├── generate.go
    │   ├── p224_fiat64.go
    │   ├── p224.go
    │   ├── p224_invert.go
    │   ├── p256_fiat64.go
    │   ├── p256.go
    │   ├── p256_invert.go
    │   ├── p384_fiat64.go
    │   ├── p384.go
    │   ├── p384_invert.go
    │   ├── p521_fiat64.go
    │   ├── p521.go
    │   ├── p521_invert.go
    │   └── README
    ├── generate.go
    ├── nistec.go
    ├── nistec_test.go
    ├── p224.go
    ├── p224_sqrt.go
    ├── p256_asm_amd64.s
    ├── p256_asm_arm64.s
    ├── p256_asm.go
    ├── p256_asm_ordinv.go
    ├── p256_asm_ordinv_test.go
    ├── p256_asm_ppc64le.s
    ├── p256_asm_s390x.s
    ├── p256_asm_table.bin
    ├── p256_asm_table_test.go
    ├── p256.go
    ├── p384.go
    └── p521.go

2 directories, 36 files
```

1. We create a folder call go_testing_env by `go mod init go_testing_env`

2. Fix all import errors, or you'll receive a CE(Compile Error). (Take `nistec` for example)

   ```sh
   $ cat nistec/p256.go 
   // Copyright 2022 The Go Authors. All rights reserved.
   // Use of this source code is governed by a BSD-style
   // license that can be found in the LICENSE file.
   
   // Code generated by generate.go. DO NOT EDIT.
   
   //go:build !amd64 && !arm64 && !ppc64le && !s390x
   
   package nistec
   
   import (
   	//"nistec/fiat"
   	"go_testing_env/nistec/fiat"
   	"crypto/subtle"
   	"errors"
   	"sync"
   )
   ...
   ```

   

3. Copy a new function by your own.

   ```sh
   $ diff go_testing_env/nistec/p256_asm.go go/src/crypto/nistec/p256_asm.go 
   29d28
   < type P256Element [4]uint64
   271d269
   < func P256FromMont(res, in *P256Element)
   ```

   ```sh
   $ diff go_testing_env/nistec/p256_asm_amd64.s go/src/crypto/nistec/p256_asm_amd64.s 
   612,689d611
   < // func P256FromMont(res, in *p256Element)
   < TEXT ·P256FromMont(SB),NOSPLIT,$0
   < 	MOVQ res+0(FP), res_ptr
   < 	MOVQ in+8(FP), x_ptr
   < 
   < 	MOVQ (8*0)(x_ptr), acc0
   < 	MOVQ (8*1)(x_ptr), acc1
   ...(just copy a new one)
   ```

   

4. Write your main.go. (Take `nistec/P256FromMont` for example).

   ```go
   package main
   
   import (
   	"go_testing_env/nistec"
   )
   
   func main() {
   	in := new(nistec.P256Element)
   	res := new(nistec.P256Element)
   	nistec.P256FromMont(res, in)
   }
   ```

   

5. Compile it.

   ```go
   $ go build main.go
   ```

6. Do itrace

   - Note that if you cannot find the function, you can use IDA or other reverse engineering tools.

   - I also modify the breakpoint usage in `scripts/itrace.py` 

     ```sh
     diff --git a/scripts/itrace.py b/scripts/itrace.py
     index 92f3547..fb7e317 100755
     --- a/scripts/itrace.py
     +++ b/scripts/itrace.py
     
     -s = gdb.execute("break *" + function, to_string=True)
     +# *************modifyed***************
     +#s = gdb.execute("break *" + function, to_string=True)
     +s = gdb.execute("b " + function, to_string=True)
     ```

     

   ```sh
   $ scripts/itrace.py top go_testing_env/nistec.P256FromMont P256FromMont.gas
   ```

   

7. Done!
